spring:
  # Shared/common configuration. Keep sensitive values out of this file; set them via env vars or a secure secret store.
  datasource:
    url: ${SPRING_DATASOURCE_URL:}
    username: ${SPRING_DATASOURCE_USERNAME:}
    password: ${SPRING_DATASOURCE_PASSWORD:}
  flyway:
    enabled: true
    locations: classpath:db/migration
    validate-on-migrate: ${SPRING_FLYWAY_VALIDATE_ON_MIGRATE:true}
    baseline-on-migrate: ${SPRING_FLYWAY_BASELINE_ON_MIGRATE:false}

  # Mail properties - prefer setting these in the prod profile or via environment variables
  mail:
    host: ${SPRING_MAIL_HOST:}
    port: ${SPRING_MAIL_PORT:}
    username: ${SPRING_MAIL_USERNAME:}
    password: ${SPRING_MAIL_PASSWORD:}
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: ${SPRING_MAIL_SMTP_AUTH:true}
          starttls:
            enable: ${SPRING_MAIL_SMTP_STARTTLS:true}

# Admin recipients (common key, can be overridden per-profile)
mail:
  admin-recipients:
    - thusharadev35@gmail.com
    - buddhi.madu02@gmail.com

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus

batch:
  jobs:
    - name: booking-reminder
      enabled: true
      schedule:
        # default schedule (30 minutes) can be overridden by profile/env var
        cron: ${JOB_BOOKING_CRON:0 0/30 * * * *}
      batchSize: ${JOB_BOOKING_BATCH_SIZE:25}
      maxRetries: 3
      concurrency: 2
      markColumn: batch_sent_at
      attemptsColumn: batch_attempts
      template:
        subject: booking-reminder-subject
        body: booking-reminder-body
      dryRun: ${JOB_BOOKING_DRY_RUN:true}

logging:
  level:
    org.springframework.mail: INFO
    org.springframework.mail.javamail: INFO
    com.zoomigo.whatsapp: INFO

# NOTES:
# - Provide production DB and mail credentials through environment variables:
#     SPRING_DATASOURCE_URL, SPRING_DATASOURCE_USERNAME, SPRING_DATASOURCE_PASSWORD
#     SPRING_MAIL_HOST, SPRING_MAIL_PORT, SPRING_MAIL_USERNAME, SPRING_MAIL_PASSWORD
# - Start the app with the prod profile active: --spring.profiles.active=prod
# - Do NOT commit secrets to version control. Use a secrets manager or CI/CD secret variables.
